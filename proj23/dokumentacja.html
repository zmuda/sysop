<html><head><title>DROPCAN</title><style type="text/css">ol{margin:0;padding:0}.c1{padding-left:0pt;direction:ltr;margin-left:36pt}.c4{list-style-type:disc;margin:0;padding:0}.c10{max-width:468pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c6{list-style-type:decimal;margin:0;padding:0}.c5{font-size:19pt;background-color:#ffffff}.c0{height:11pt;direction:ltr}.c9{line-height:1.0;padding-bottom:8pt}.c2{font-weight:bold}.c3{direction:ltr}.c11{font-style:italic}.c8{text-align:center}.c7{font-size:12pt}.title{padding-top:0pt;line-height:1.15;text-align:left;color:#000000;font-size:21pt;font-family:"Trebuchet MS";padding-bottom:0pt}.subtitle{padding-top:0pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:13pt;font-family:"Trebuchet MS";padding-bottom:10pt}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:10pt;line-height:1.15;text-align:left;color:#000000;font-size:16pt;font-family:"Trebuchet MS";padding-bottom:0pt}h2{padding-top:10pt;line-height:1.15;text-align:left;color:#000000;font-size:13pt;font-family:"Trebuchet MS";font-weight:bold;padding-bottom:0pt}h3{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-size:12pt;font-family:"Trebuchet MS";font-weight:bold;padding-bottom:0pt}h4{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-size:11pt;text-decoration:underline;font-family:"Trebuchet MS";padding-bottom:0pt}h5{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-size:11pt;font-family:"Trebuchet MS";padding-bottom:0pt}h6{padding-top:8pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Trebuchet MS";padding-bottom:0pt}</style></head><body class="c10"><h3 class="c3 c9"><span class="c5">Projekt 23. Program do tworzenia kopii zapasowych na wz&oacute;r Dropboxa</span></h3><p class="c0 c8"><span class="c2 c7"></span></p><p class="c0"><span class="c2"></span></p><p class="c3"><span class="c2">Co to jest:</span></p><ol class="c4" start="1"><li class="c1"><span>zestaw program&oacute;w klient-serwer s&#322;u&#380;&#261;cy do tworzenia lokalnych kopii plik&oacute;w z danego folderu</span></li><li class="c1"><span>zachowywanie archiwalnych plik&oacute;w i mo&#380;liwo&#347;&#263; ich przywr&oacute;cenia przez program kliencki</span></li><li class="c1"><span>utrzymanie w katalogach obs&#322;ugiwanych przez programy klienckie sp&oacute;jnej wersji plik&oacute;w</span></li></ol><p class="c0"><span class="c2"></span></p><p class="c3"><span class="c2">Problemy:</span></p><ol class="c4" start="1"><li class="c1"><span>jak utrzyma&#263; maksymaln&#261; wydajno&#347;&#263; dost&#281;pu do zasob&oacute;w wspolnych</span></li><li class="c1"><span>jak zsynchronizowa&#263; wszystkie programy klienckie tak, &#380;eby nie &ldquo;uploadowa&#322;y&rdquo; r&oacute;wnocze&#347;nie zmian </span></li><li class="c1"><span>jak wymusi&#263; sp&oacute;jno&#347;&#263; danych podczas przywracania archiwalnej wersji</span></li></ol><p class="c0"><span class="c2"></span></p><p class="c3"><span class="c2">Jak to jest zrobione:</span></p><ol class="c6" start="1"><li class="c1"><span>pami&#281;&#263; wsp&oacute;&#322;dzielona z informacjami o bie&#380;&#261;cych wersjach plik&oacute;w</span></li><li class="c1"><span>kolejka i semafory POSIX (pewna adaptacja problemu czytelnik&oacute;w i pisarzy, patrz ad2.)</span></li><li class="c1"><span>semafory dla poszczeg&oacute;lnych plik&oacute;w tworzone w runtime (blokuj&#261;ce na czas modyfikacji) - dla tego POSIX&rsquo;owe</span></li><li class="c1"><span>folder na zmiany oczekuj&#261;ce, patrz ad3.</span></li><li class="c1"><span>serwer utrzymuje struktur&#281; synchronizowanego katalogu z wykorzystaniem dowi&#261;za&#324; twardych do wybranych wersji pliku</span></li><li class="c1"><span>klient skanuje sw&oacute;j folder w poszukiwaniu zmian</span></li><li class="c1"><span>klient skanuje wsp&oacute;&#322;dzielon&#261; tablic&#281; w poszukiwaniu zmian</span></li><li class="c1"><span>pliki znacznik&oacute;w czasowych po stronie klienta odpowiadaj&#261;ce za mo&#380;liwo&#347;&#263; zmian</span></li><li class="c1"><span>przywracanie wersji powoduje blokad&#281; danego pliku a&#380; do czasu zako&#324;czenia procesu przywracania (utrzymujemy sp&oacute;jny stan)</span></li></ol><p class="c0"><span class="c2"></span></p><p class="c0"><span class="c2"></span></p><p class="c3"><span class="c2">Szczeg&oacute;&#322;y:</span></p><p class="c3"><span class="c2">ad1.</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;przechowujemy aktualn&#261; zawarto&#347;&#263; serwera w postaci listy plik&oacute;w wraz ze znacznikami o aktywno&#347;ci pliku( czy nie zosta&#322; usuni&#281;ty), jego wzgl&#281;dnej &#347;cie&#380;ce oraz czas modyfikacji</span></p><p class="c3"><span class="c2">ad2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>dost&#281;p do zasobu tablicy jest organizowany na zasadzie serwer=pisarz, klient=czytelnik; taka organizacja wynika z modelu wsp&oacute;&#322;pracy - serwer zarz&#261;dza aktualn&#261; wersj&#281; i jako jedyny modyfikuje tablic&#281;, klient odczytuje jej zawarto&#347;&#263; w poszukiwaniu zmian do pobrania; </span></p><p class="c3"><span class="c11">dobra wydajno&#347;&#263;</span></p><p class="c3"><span class="c2">ad3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>gdy klient zechce zg&#322;osi&#263; zmian&#281; (i jest uprawniony) blokuje modyfikacj&#281; danego pliku - generowany jest i blokowany semafor dla tego pliku (aby nikt inny nie zmienia&#322; pliku); &oacute;w semafor odblokowywany jest przez serwer po pomy&#347;lnym przetworzeniu zg&#322;oszenia zmiany; blokujemy jedynie wybrane pliki - </span><span class="c11">dobra wydajno&#347;&#263;</span></p><p class="c3"><span class="c2">ad4.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>poniewa&#380; tylko jedna wersja pliku mo&#380;e by&#263; zg&#322;aszana r&oacute;wnocze&#347;nie do zmiany modyfikowane wersje umieszczane s&#261; w folderze oczekuj&#261;cych zmian kt&oacute;ry skanuje serwer; uploadowane s&#261; pliki z zachowaniem wszelkich informacji dotycz&#261;cych czas&oacute;w modyfikacji itp.</span></p><p class="c3"><span class="c2">ad5.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>serwer w ukrytych katalogach przetrzymuje wersje archiwalne tymczasem odwzorowuj&#261;c struktur&#281; katalogu za pomoc&#261; dowi&#261;za&#324; twardych - zapobiega to mno&#380;eniu plik&oacute;w i gwarantuje dost&#281;p do w&#322;a&#347;ciwych wersji przez programy klienckie</span></p><p class="c3"><span class="c2">ad8.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>klient w momencie modyfikacji pliku w swoim katalogu tworzy plik posiadaj&#261;cy w nazwie znacznik czasowy - dop&oacute;ki &oacute;w znacznik nie b&#281;dzie zgodny z wersj&#261; serwera klient musi wstrzyma&#263; si&#281; z wysy&#322;aniem modyfikacji; w ten spos&oacute;b klient nie wy&#347;le nieaktualnej wersji pliku (poprzedniej) ani nie nadpisze zmiany wysy&#322;anej przez inny program kliencki</span></p><p class="c3"><span class="c2">ad9.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>na czas wybierania wersji nale&#380;y &ldquo;zamrozi&#263;&rdquo; dany plik, aby nikt nie zmodyfikowa&#322; go mimo naszej wiedzy w czasie mi&#281;dzy odebraniem listy dost&#281;pnych wersji (klient skanuje odpowiednie struktury) a wyznaczeniem wersji aktualnej; wyznaczenie aktualnej to skopiowanie wybranej jako nowa (nowy znacznik czasowy) - w ten spos&oacute;b mamy pe&#322;n&#261; histori&#281; zmian z wyr&oacute;&#380;nieniem wszelkich wersji (mo&#380;na dowiedzie&#263; si&#281; o wersji, kt&oacute;ra by&#322;a przywr&oacute;ceniem archiwalnej)</span></p><p class="c0"><span></span></p><p class="c3"><span class="c2">Uruchomienie:</span></p><p class="c3"><span>Dostarczony jest makefile. Aplikacji serwera jako argument podajemy nazw&#281; katalogu, w kt&oacute;rym bedzie przechowywa&#322; dane - najlepiej nieistniejcy katalog. Aplikacji klienta przekazujemy nazw&#281; istniej&#261;cego katalogu, kt&oacute;ry b&#281;dzie synchronizowany.</span></p><p class="c0"><span></span></p><p class="c0"><span></span></p><p class="c3"><span class="c2">Ograniczenia (&ldquo;jak na spowiedzi&rdquo;):</span></p><ol class="c4" start="1"><li class="c1"><span>nie mo&#380;e wyst&#261;pi&#263; katalog &ldquo;.commited&rdquo; w katalogu synchronizowanym</span></li><li class="c1"><span>nie mog&#261; wyst&#261;pi&#263; pliki &ldquo;...[napis]&rdquo; &nbsp;w katalogu synchronizowanym</span></li><li class="c1"><span>puste katalogi nie s&#261; synchronizowane (jako, &#380;e nie nios&#261; informacji)</span></li><li class="c1"><span>&#347;cie&#380;ki wzgl&#281;dne nie mog&#261; mie&#263; wi&#281;cej ni&#380; 256 znak&oacute;w (mo&#380;na zmieni&#263; makro)</span></li></ol><p class="c0"><span class="c2"></span></p><p class="c3"><span class="c2">Cechy dyskusyjne:</span></p><ol class="c4" start="5"><li class="c1"><span>mo&#380;emy zmienia&#263; tylko aktualn&#261; wersj&#281; - zmiana po stronie klienta nieaktualnej wersji powoduje porzucenie tej zmiany ( to raczej logiczne )</span></li><li class="c1"><span>brak przewidzenia potrzeby czasowgo wy&#322;&#261;czenia serwera</span></li><li class="c1"><span>tylko lokalne zastosowanie</span></li></ol><p class="c0"><span class="c2"></span></p><p class="c0"><span class="c2"></span></p><p class="c3"><span class="c2">Grafiki:</span></p><p class="c3"><span class="c2">a) skr&oacute;t zg&#322;aszania zmiany:</span><img height="522" src="images/image01.png" width="713"></p><p class="c0"><span class="c2"></span></p><p class="c0"><span class="c2"></span></p><p class="c3"><span class="c2">b) skr&oacute;t odbioru zmiany (usuni&#281;cia):</span></p><p class="c0"><span class="c2"></span></p><p class="c0"><span class="c2"></span></p><p class="c3"><img height="417" src="images/image00.png" width="658"></p><p class="c0"><span class="c2"></span></p><p class="c0"><span class="c2"></span></p><p class="c0"><span class="c2"></span></p><p class="c0"><span class="c2"></span></p><p class="c0"><span class="c2"></span></p><p class="c0"><span class="c2"></span></p><p class="c0"><span class="c2"></span></p><p class="c0"><span class="c2"></span></p><p class="c0"><span class="c2"></span></p><p class="c0"><span class="c2"></span></p><p class="c0"><span class="c2"></span></p><p class="c0"><span class="c2"></span></p></body></html>